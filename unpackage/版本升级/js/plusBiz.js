function getMobilePhoto(a){plus.nativeUI.actionSheet({title:"选择照片",cancel:"取消",buttons:[{title:"拍照"},{title:"从相册中选择"}]},function(b){if(b.index==1){takePicture(a)}else{if(b.index==2){openGallery(a)}}})}function takePicture(b){var a=plus.camera.getCamera();a.captureImage(function(c){plus.io.resolveLocalFileSystemURL(c,function(d){var e=d.toLocalURL();console.log("拍照=="+e);b&&b(e)},function(d){mui.toast("读取拍照文件错误："+d.message)})},function(c){},{filename:"_doc/camera/",index:1})}function openGallery(a){plus.gallery.pick(function(b){console.log("从相册选择照片=="+b);a&&a(b)},function(b){if(b.code==-3310||b.code==8){mui.toast("您已禁止APP访问相册,请设置开启权限")}},{filter:"image",multiple:false,system:false})}function ZipBiz(b,d,c,a){this.isLog=true;this.imgpath=b;this.tag=a;this.width=c||plus.screen.resolutionWidth;this.callback=d;this.imgZip="file://"+plus.io.convertLocalFileSystemURL("_doc/zip/"+new Date().getTime()+".jpg")}ZipBiz.prototype.start=function(){var a=this;if(a.imgpath.indexOf("http")!=-1){a.loadImage(function(b){a.imgpath=b;a.compressImage()})}else{a.compressImage()}};ZipBiz.prototype.compressImage=function(){showWaiting();var b=this;var a={src:b.imgpath,dst:b.imgZip,width:b.width+"px",overwrite:true,quality:50};plus.zip.compressImage(a,function(c){plus.nativeUI.closeWaiting();b.isLog&&console.log("压缩后的路径="+c.target+",大小="+(c.size/1024)+"k,width="+c.width+",height="+c.height);b.callback(c.target,b.tag)},function(c){plus.nativeUI.closeWaiting();b.callback();b.isLog&&mui.toast("压缩异常="+JSON.stringify(c))})};ZipBiz.prototype.loadImage=function(e){var c=this;showWaiting();var b=this.imgpath;var a="_downloads/image/"+new Date().getTime()+".jpg";c.isLog&&console.log("loadPath="+b+",encode="+encodeURI(b)+",savePath="+a);if(escape(b).indexOf("%u")>=0){b=encodeURI(b)}var d=plus.downloader.createDownload(b,{filename:a,timeout:10,retry:1},function(h,f){plus.nativeUI.closeWaiting();if(f==200){c.isLog&&console.log("图片下载成功=="+h.filename);var g="file://"+plus.io.convertLocalFileSystemURL(h.filename);e&&e(g)}else{c.isLog&&mui.toast("图片下载失败"+f);c.callback()}});d.start()};function upLoadFileByPlus(c,e,d){var a=true;showWaiting("图片上传中...");a&&console.log("图片上传中: "+c);var b=plus.uploader.createUpload(Host+"api/Order/UploadFile",{method:"POST",timeout:20,retryInterval:1},function(h,g){plus.nativeUI.closeWaiting();if(g==200){var f=h.responseText;console.log("上传回调=="+f);e&&e(f)}else{mui.toast("上传失败: "+g);a&&console.log("上传失败: "+g)}});b.addFile(c,{key:""+(new Date().getTime())});for(key in d){b.addData(key,d[key])}b.start()}function upLoadFileByBase64(b,c,a){getBase64Image(b,function(d,e){d=d.split(",")[1];var f={ajaxtype:"post",CashTransactionId:a,FileType:e.toUpperCase(),Base64File:d};ajaxData(Host+"api/Order/UploadFile",function(g){if(g.Status==200){c&&c(g)}else{return g.Message}},f)})}function getBase64Image(a,c){var b=new Image();b.src=a;b.onload=function(){var f=document.createElement("canvas");f.width=b.width;f.height=b.height;var e=f.getContext("2d");e.drawImage(b,0,0,b.width,b.height);var g=b.src.substring(b.src.lastIndexOf(".")+1).toLowerCase();var d=f.toDataURL("image/"+g);c&&c(d,g)}}function uploadMobileBase64(b,a){getMobilePhoto(function(c){new ZipBiz(c,function(d){upLoadFileByBase64(d,b,a)}).start()})};