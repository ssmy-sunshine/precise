var isConsole=true;var Host="http://123.207.55.23:60/";document.addEventListener("plusready",function(){$(".wb-back").click(function(){mui.back()});$(".tohref").click(function(){var b=this.getAttribute("isLogin");if(b&&!UserObj.isLogin()){return}var a=this.getAttribute("href");openWindow(a)});if(mui.os.android){plus.webview.currentWebview().setStyle({popGesture:"none"})}});var UserObj={getUid:function(){var a=localStorage.getItem("Uid");if(a){a=Number(a)}return a},setUid:function(a){setLocalStorage("Uid",a)},getIcon:function(a){if(a){return getImgpath(a)}else{return localStorage.getItem("UserIcon")}},setIcon:function(a){setLocalStorage("UserIcon",UserObj.getIcon(a))},getUsername:function(){return localStorage.getItem("Username")},setUsername:function(a){setLocalStorage("Username",a)},getPhoneNumber:function(){return localStorage.getItem("PhoneNumber")},setPhoneNumber:function(a){setLocalStorage("PhoneNumber",a)},getPassword:function(){return localStorage.getItem("password")},setPassword:function(a){setLocalStorage("password",a)},getNickname:function(){return localStorage.getItem("UNickName")},setNickname:function(a){setLocalStorage("UNickName",a)},getComboId:function(){return localStorage.getItem("ComboId")},setComboId:function(a){setLocalStorage("ComboId",a)},getLevelName:function(){return localStorage.getItem("LevelName")},setLevelName:function(a){setLocalStorage("LevelName",a)},getSharesCount:function(){return Number(localStorage.getItem("SharesCount")||0)},setSharesCount:function(a){setLocalStorage("SharesCount",a)},getShareAmount:function(){return Number(localStorage.getItem("ShareAmount")||0)},setShareAmount:function(a){setLocalStorage("ShareAmount",a)},getSharesPrice:function(){return Number(localStorage.getItem("SharesPrice")||0)},setSharesPrice:function(a){setLocalStorage("SharesPrice",a)},getCountPrice:function(){return localStorage.getItem("CountPrice")||"0.00"},setCountPrice:function(a){setLocalStorage("CountPrice",a)},getInviteCode:function(){return localStorage.getItem("InviteCode")},setInviteCode:function(a){setLocalStorage("InviteCode",a)},getIntegration:function(){return localStorage.getItem("Integration")||"0"},setIntegration:function(a){setLocalStorage("Integration",a)},getAmount:function(){return Number(localStorage.getItem("Amount")||0)},setAmount:function(a){setLocalStorage("Amount",a)},getRegisterAmount:function(){return localStorage.getItem("RegisterAmount")||"0"},setRegisterAmount:function(a){setLocalStorage("RegisterAmount",a)},getPrevMemberId:function(){return localStorage.getItem("PrevMemberId")},setPrevMemberId:function(a){setLocalStorage("PrevMemberId",a)},getBankName:function(){return localStorage.getItem("BankName")},setBankName:function(a){setLocalStorage("BankName",a)},getBankCard:function(){return localStorage.getItem("BankCard")},setBankCard:function(a){setLocalStorage("BankCard",a)},getBankAccName:function(){return localStorage.getItem("BankAccName")},setBankAccName:function(a){setLocalStorage("BankAccName",a)},getTestTag:function(){return localStorage.getItem("USER_ISTEST")},setTestTag:function(a){setLocalStorage("USER_ISTEST",a)},getToken:function(){return localStorage.getItem("access_token")},setToken:function(a){setLocalStorage("access_token",a)},getTokenType:function(){return localStorage.getItem("token_type")},setTokenType:function(a){setLocalStorage("token_type",a)},getTokenRefresh:function(){return localStorage.getItem("refresh_token")},setTokenRefresh:function(a){setLocalStorage("refresh_token",a)},isLogin:function(a){if(UserObj.getUid()&&UserObj.getToken()){return true}else{if(a!=false){openWindow("../account/login.html",{isCanBack:false})}return false}},login:function(e,a,d,b){if(e&&a){var c={ajaxtype:"post",username:e,password:a,grant_type:"password"};ajaxData(Host+"token",function(f){UserObj.setToken(f.access_token);UserObj.setUsername(f.userName);UserObj.setTokenType(f.token_type);UserObj.setTokenRefresh(f.refresh_token);UserObj.setUid(f["as:client_id"]);return d&&d()},c,function(f){return b&&b(f)})}else{if(!window.hasToLogin){window.hasToLogin=true;openWindow("../account/login.html",{isCanBack:false})}}},refreshToken:function(d,b){var a=UserObj.getTokenRefresh();if(a){var c={ajaxtype:"post",refresh_token:a,grant_type:"refresh_token"};ajaxData(Host+"token",function(e){UserObj.setToken(e.access_token);UserObj.setTokenRefresh(e.refresh_token);return d&&d()},c,function(f){openWindow("../account/login.html",{isCanBack:false})})}else{if(!window.hasToLogin){window.hasToLogin=true;openWindow("../account/login.html",{isCanBack:false})}}},getUserinfo:function(b,a){if(UserObj.isLogin(false)){ajaxData(Host+"api/Account/GetMemberInfo",function(d){if(d.Status==200){var c=d.Data;UserObj.setIcon(c.ImgUrl);UserObj.setNickname(c.Name);UserObj.setPhoneNumber(c.PhoneNumber);UserObj.setComboId(c.ComboId);UserObj.setLevelName(c.Level);UserObj.setSharesCount(c.SharesCount);UserObj.setShareAmount(c.ShareAmount);UserObj.setSharesPrice(c.SharesPrice);UserObj.setCountPrice(c.CountPrice);UserObj.setIntegration(c.Integration);UserObj.setAmount(c.Amount);UserObj.setInviteCode(c.InviteCode);UserObj.setRegisterAmount(c.RegisterAmount);UserObj.setPrevMemberId(c.PrevMemberId);UserObj.setBankCard(c.BankCard);UserObj.setBankAccName(c.BankAccName);UserObj.setBankName(c.BankName);UserObj.setTestTag(c.Type);return b&&b(c)}else{return b&&b()}},null,function(){return b&&b()},a)}else{b&&b()}},notifyView:function(){var c=["main-home.html","main-user.html","main-share.html","../user/ReginAmount.html","../user/CashAmount.html","../trade/sell-share.html"];for(var b=0;b<c.length;b++){var a=plus.webview.getWebviewById(c[b]);a&&a.evalJS("EJ_SetUserInfo()")}},addNotifyListener:function(a){UserObj.notifyListener=a}};function EJ_SetUserInfo(){$("#Username").html(UserObj.getUsername());$("#LevelName").html(UserObj.getLevelName());$("#SharesCount").html(UserObj.getSharesCount());$("#ShareAmount").html(UserObj.getShareAmount());$("#SharesPrice").html(UserObj.getSharesPrice());$("#CountPrice").html(UserObj.getCountPrice());$("#RegisterAmount").html(UserObj.getRegisterAmount());$("#Amount").html(UserObj.getAmount());$("#Integration").html(UserObj.getIntegration());$("#InviteCode").html(UserObj.getInviteCode());$("#Nickname").html(UserObj.getNickname());$("#BankName").html(UserObj.getBankName());$("#BankCard").html(UserObj.getBankCard());$("#BankAccName").html(UserObj.getBankAccName());UserObj.notifyListener&&UserObj.notifyListener()}function setLocalStorage(a,b){if(b){localStorage.setItem(a,b)}else{localStorage.removeItem(a)}}function getImgpath(a,b){if(!a||a.indexOf("http://")!=-1){return a}else{if(b>0){var c=a.substr(a.lastIndexOf("."),4);a=a.replace(c,"_"+b+"x"+b+c)}}return HostImg+a}function ajaxData(d,g,f,e,c){f=f||{};f.ajaxtype=f.ajaxtype||"get";f.version=localStorage.getItem("version");f.tryNum=0;var b;if(f.ajaxtype=="get"){d+=d.indexOf("?")==-1?"?":"&";for(key in f){d+=key+"="+f[key]+"&"}}else{b=f}function a(){f.tryNum++;if(f.tryNum>3){mui.toast("请求超时,请重试. v"+f.version);return}if(!c){showWaiting()}mui.ajax(d,{data:b,type:f.ajaxtype,dataType:"json",headers:{Authorization:UserObj.getTokenType()+" "+UserObj.getToken()},timeout:10000,success:function(i){isConsole&&console.log("请求url--> "+d+" POST参数--> "+JSON.stringify(b)+" 结果-->"+JSON.stringify(i));if(!c){plus.nativeUI.closeWaiting()}if(i.Status==401){if(!window.isGetTK){window.isGetTK=true;UserObj.refreshToken(function(){a()})}else{setTimeout(function(){a()},1000)}}else{var h=g&&g(i);h&&mui.toast(h+" v"+f.version)}},error:function(j){isConsole&&console.log("请求url--> "+d+" POST参数--> "+JSON.stringify(b)+" 异常--> "+j.responseText);if(!c){plus.nativeUI.closeWaiting()}if(f.tryNum<=3&&(j.status==406||j.status==0)){setTimeout(function(){a()},1000)}else{var h=j.status==400?JSON.parse(j.response):j;var i=e&&e(h);if(i!=false){if(!i){i=h.error_description||(j.status+" "+j.responseText+" v"+f.version)}if(j.responseText!='{"error":"invalid_grant"}'){mui.toast(i)}}}}})}a()}function showWaiting(a,b){b=b==null?true:false;plus.nativeUI.showWaiting(a||"请稍后...",{width:"50%",padding:"16px",modal:b})}function openWindow(c,d,a){if(a){var b=plus.webview.currentWebview();setTimeout(function(){b.hide("none");b.close("none")},600)}mui.openWindow({url:c,id:c,extras:d||{},waiting:{autoShow:false,title:"正在加载...",options:{width:"50%"}},styles:{scrollIndicator:"none"},show:{aniShow:"pop-in",duration:400}})}function preloadWindow(a,d,b){b=b||{};b.scrollIndicator="none";var c=mui.preload({url:a,id:a,styles:b,extras:d});return c}function showWindow(a,c,b){var d=typeof a=="object"?a:plus.webview.getWebviewById(a);if(d){if(b>0){setTimeout(function(){d.show(c||"pop-in",400)},b)}else{d.show(c||"pop-in",400)}}}function loadimg(a,d,e){var c=(typeof a=="object")?a:document.getElementById(a);if(c){var b=new Image();b.onload=function(){c.onload=null;if(e){e(c,d)}else{c.src=b.src;c.classList.add("anim_opacity")}};b.src=d||c.getAttribute("data-src")}}function EmptyBox(a){this.optEmpty={warpId:null,icon:"../img/logo-gray.png",tip:"暂无相关数据~",isClear:true,btntext:"",btnClick:null};mui.extend(this.optEmpty,a)}EmptyBox.prototype.show=function(){var a=this;var b=a.optEmpty;if(b.warpId==null){return}var e=document.getElementById(b.warpId);if(e){a.remove();var d="";if(b.icon){d+='<img class="empty-icon" src="'+b.icon+'"/>'}if(b.tip){d+='<p class="empty-tip">'+b.tip+"</p>"}if(b.btntext){d+='<p class="empty-btn">'+b.btntext+"</p>"}a.emptyDom=document.createElement("div");a.emptyDom.className="empty-box";a.emptyDom.innerHTML=d;if(b.isClear){e.innerHTML=""}e.appendChild(a.emptyDom);if(b.btnClick){var c=a.emptyDom.getElementsByClassName("empty-btn")[0];c.onclick=function(){b.btnClick()}}}};EmptyBox.prototype.remove=function(){if(this.emptyDom){var a=this.emptyDom.parentNode;if(a){a.removeChild(this.emptyDom)}this.emptyDom=null}};function Shadow(a,b){this.zIndex=b;this.click=a}Shadow.prototype.show=function(){if(document.getElementsByClassName("wb-shadow").length==0){var b=document.createElement("div");b.setAttribute("class","wb-shadow");document.body.appendChild(b);if(this.zIndex){b.style.zIndex=this.zIndex}var a=this;b.onclick=function(){a.click&&a.click()}}};Shadow.prototype.hide=function(){var b=document.getElementsByClassName("wb-shadow");for(var a=0;a<b.length;a++){document.body.removeChild(b[a])}};Date.prototype.formats=function(f){var e=this.getFullYear();var g=this.getMonth()+1;var i=this.getDate();var c=this.getHours();var a=this.getMinutes();var b=this.getSeconds();var j=function(d){if(d<10){d="0"+d}return d};if(f==1){return e+"年"+j(g)+"月"+j(i)+"日 "+j(c)+":"+j(a)+":"+j(b)}else{if(f==2){return e+"年"+j(g)+"月"+j(i)+"日"}else{if(f==3){return e+"-"+j(g)+"-"+j(i)}else{if(f==4){return e+"."+j(g)+"."+j(i)}else{return e+"-"+j(g)+"-"+j(i)+" "+j(c)+":"+j(a)+":"+j(b)}}}}};function dateToMsec(str){if(!str){return new Date().getTime()}else{if(str.indexOf("Date")!=-1){str.replace(/Date\([\d+]+\)/,function(dateStr){eval("dateObj = new "+dateStr)});return dateObj.getTime()}else{str=str.replace("-","/").replace("-","/");return new Date(str).getTime()}}}function getDateDiff(b,a){return dateToMsec(b)-dateToMsec(a)}function trimDateStr(a){return a.substring(0,a.lastIndexOf(":")+3).replace("T"," ")}function addTelHref(b,a){var c=document.getElementById(b);if(c&&a){c.addEventListener("tap",function(){mui.confirm("拨打电话 : "+a,null,["取消","立即拨打"],function(d){if(d.index==1){window.location.href="tel:"+a}})})}}function copyText(g,e){if(mui.os.android){var c=plus.android.importClass("android.content.Context");var a=plus.android.runtimeMainActivity();var d=a.getSystemService(c.CLIPBOARD_SERVICE);plus.android.invoke(d,"setText",g)}else{if(mui.os.ios){var b=plus.ios.importClass("UIPasteboard");var f=b.generalPasteboard();f.plusCallMethod({setValue:g,forPasteboardType:"public.utf8-plain-text"});f.plusCallMethod({valueForPasteboardType:"public.utf8-plain-text"})}}mui.toast(e||"复制成功")}function initTabClick(b,d,c,a){var a=a||0;$(b+" "+d).each(function(e,f){f.setAttribute("i",e);if(e==a){f.classList.add("tab-active")}}).click(function(){var e=Number(this.getAttribute("i"));if(a!=e){$(b+" .tab-active").removeClass("tab-active");this.classList.add("tab-active");c&&c(e,this,a);a=e}})}Array.prototype.indexOf=function(b){for(var a=0;a<this.length;a++){if(this[a]==b){return a}}return -1};Array.prototype.remove=function(b){var a=this.indexOf(b);while(a>-1){this.splice(a,1);a=this.indexOf(b)}};function doubleTapQuit(){if(mui.os.ios){return}var a=null;mui.back=function(){if(!a){a=(new Date()).getTime();mui.toast("再按一次退出应用");setTimeout(function(){a=null},1000)}else{if((new Date()).getTime()-a<1000){plus.runtime.quit()}}}}function removeHtmlTab(a){return a.replace(/<[^<>]+?>/g,"*")};